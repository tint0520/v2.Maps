<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tint Maps ç¾æ¥­åœ°åœ– App</title>

  <!-- å­—å‹èˆ‡æ¡†æ¶ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"/>
<link rel="manifest" href="./manifest.json">
  <style>
    html, body { height: 100%; margin: 0; padding: 0; font-family: 'Noto Sans TC', sans-serif; }

  #map-view, #card-view, #favorite-view { 
  display: none; 
  height: calc(100% - 110px); 
}

/* å¡ç‰‡æ¢åº—æ¨¡å¼çš„æ•´é«”èƒŒæ™¯ï¼ˆå¡ç‰‡å¾Œé¢çš„èƒŒæ™¯é¡è‰²ï¼‰ */
#card-view {
  background-color: #fff3f7; /* éå¸¸æŸ”å’Œçš„æ·ºç²‰è‰²ï¼Œæ¯” banner æ›´æ·º */
}
    .top-banner {
  width: 100%;
  height: 85px; /* èª¿æ•´é«˜åº¦çµ¦å…©è¡Œæ–‡å­—æ›´å¤šç©ºé–“ */
  background-color: #ffecf2; /* åŸæœ‰æ·ºç²‰è‰²èƒŒæ™¯ */
  display: flex;
  flex-direction: column; /* å‚ç›´æ’åˆ— */
  align-items: center; /* æ°´å¹³ç½®ä¸­ */
  justify-content: center; /* å‚ç›´ç½®ä¸­ */
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

    .map-btn {
  color: #0d6efd; /* è—è‰² */
  cursor: pointer;
  text-decoration: underline;
}

.map-btn:hover {
  color: #0a58ca;
}
    /* æ‰€æœ‰æ®µè½ä¹‹é–“è·é›¢ */
.store-info p {
  margin-bottom: 6px; /* ä¸€èˆ¬æ®µè½é–“è·ï¼Œä¾éœ€æ±‚èª¿æ•´ */
}
   .store-distance {
  position: relative;  /* æ”¹æˆç›¸å°ä½ç½®ï¼Œè®“è·é›¢è²¼è‘—ä¸Šæ–¹è³‡è¨Š */
  margin-top: 20px;     /* è·é›¢ä¸Šé¢åº—å®¶è³‡è¨Šçš„é–“è· */
  font-size: 15px;
  color: #888;
  text-align: left;    /* è·é›¢æ–‡å­—é å·¦å°é½Š */
  padding-left: 10px;  /* è·Ÿä¸Šé¢è³‡è¨Šå·¦å´å°é½Š */
}
.banner-text {
  font-size: 26px; /* ä¸»æ¨™é¡Œå¤§å° */
  color: #d63384;
  font-weight: bold;
}

.banner-subtext {
  font-size: 16px; /* æ¬¡æ¨™é¡Œå¤§å° */
  color: #888; /* æ·ºç°è‰²æ–‡å­— */
}
    #bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0; height: 60px;
      background: white; display: flex; border-radius: 15px 15px 0 0;
      box-shadow: 0 -3px 10px rgba(0,0,0,0.15); z-index: 10;
    }

    .nav-btn { flex: 1; padding: 10px; text-align: center; color: #555; font-size:14px; }

    .swiper-container { height: 50%; padding-top: 20px; }

    .swiper-slide {
      width: 82%; border-radius: 18px; box-shadow: 0 1.6px 6.4px rgba(0,0,0,0.15);
      overflow-y: auto; background-color: #ffffff; /* ç´”ç™½è‰²èƒŒæ™¯ */ 
    }

    .swiper-slide img { height: 200px; object-fit: cover; width: 100%; }  // å¡ç‰‡åœ–ç‰‡é«˜åº¦

   /* å¡ç‰‡å…§æ–‡å¢åŠ ç©ºé–“æ„Ÿ */
.store-info {
  padding: 25px 20px 10px 20px; /* ä¸Šæ–¹è·é›¢è®Šæˆ25pxï¼Œæ–‡å­—å€å¡Šæ•´é«”å‘ä¸‹ç§»å‹• */
  font-size: 14px;
  line-height: 1.6;
}
/* èª¿æ•´å…§æ–‡ä¸è¦è²¼é½Šå·¦å´ */
.store-info h5,
.store-info p {
  padding-left: 10px; /* æ¨™é¡Œå’Œå…§æ–‡ç¨å¾®å¾€å³ç§»å‹• */
}

/* æˆ‘è¦é ç´„ã€IGã€LINE é€£çµç½®ä¸­ */
.store-info p:last-child {
  text-align: center;
}

/* è·é›¢ã€åœ°åœ–ä½ç½®ã€å°èˆªç½®ä¸­ */
.store-distance {
  text-align: center; /* æ–‡å­—æ°´å¹³ç½®ä¸­ */
  padding-left: 0; /* ç§»é™¤åŸæœ¬çš„padding-left */
}
/* åº•éƒ¨çš„è·é›¢å€å¡Š */
.store-distance {
  margin-top: 14px; /* è·é›¢ä¸Šæ–¹è³‡è¨Šå†æ‹‰é–‹ä¸€é» */
  padding-bottom: 12px; /* è·é›¢åº•éƒ¨ä¹Ÿæ‹‰é–‹ä¸€é» */
  font-size: 14px;
  color: #888;
  text-align: left;
  padding-left: 15px; /* èˆ‡ä¸Šæ–¹è³‡è¨Šå·¦å´å°é½Š */
}

/* èª¿æ•´é€£çµä¹‹é–“çš„é–“éš” */
.store-info a {
  margin-right: 8px; /* å„å€‹é€£çµé–“è·ç¨å¾®æ‹‰é–‹ä¸€é» */
}
.favorite-btn {
  position: absolute;
  top: 10px; 
  right: 10px; 
  cursor: pointer;
  font-size: 24px;  
  color: #ffd700; /* é‡‘é»ƒè‰²æ˜Ÿæ˜Ÿ */
  text-shadow: 0 1px 3px rgba(0,0,0,0.2);
  z-index: 5;
}
    /* æ­¡è¿ç•«é¢æ¨£å¼ */
#splash-screen {
  position: fixed;
  z-index: 9999;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #ffecf2;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

/* è¼‰å…¥åœˆåœˆå‹•ç•« */
.loader {
  width: 24px;
  height: 24px;
  border: 3px solid #fff;
  border-top: 3px solid #d63384;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>
 <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBLCB3EKFwsIqPwEEL_hxL7zluVpnzcCNM&callback=initMap"></script>
  <script defer>
   const SHEET_URL = "https://docs.google.com/spreadsheets/d/1iKVLOjHA2w29Y96Hlg78hgivnjV-ntx2LJvhFpeiFUs/export?format=csv&gid=0";

let map, markers = [], stores = [], userLocation, swiper, favorites;

// åˆå§‹åŒ– Google åœ°åœ–
function initMap() {
  map = new google.maps.Map(document.getElementById("map-view"), {
    center: { lat: 25.034, lng: 121.564 },
    zoom: 13,
    streetViewControl: false,
    mapTypeControl: false,
    fullscreenControl: false,
    zoomControl: false
  });

  navigator.geolocation.getCurrentPosition(pos => {
    userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
    map.setCenter(userLocation);

    new google.maps.Marker({
      position: userLocation,
      map,
      title: "ä½ çš„ä½ç½®",
      icon: {
        url: "https://github.com/tint0520/tint-town/blob/main/local_peo.png?raw=true",
        scaledSize: new google.maps.Size(40, 40)
      }
    });

    loadStoreData();
  }, () => {
    alert('ç„¡æ³•å–å¾—ä½ çš„å®šä½ï¼Œè·é›¢åŠŸèƒ½å°‡ç„¡æ³•ä½¿ç”¨ã€‚');
    loadStoreData();
  });

  showView('map-view');
}

// è¼‰å…¥åº—å®¶è³‡æ–™
function loadStoreData() {
  Papa.parse(SHEET_URL, { download: true, header: true, complete: results => {
    stores = results.data;
    markers.forEach(m => m.setMap(null));
    markers = [];

    stores.forEach((store, index) => {
      if (!store.latlng) return;
      const [lat, lng] = store.latlng.split(",").map(Number);
      store.distance = userLocation ? calcDistance(userLocation.lat, userLocation.lng, lat, lng) : '--';

      const marker = new google.maps.Marker({
        position: { lat, lng },
        map,
        title: store.name,
        icon: {
          url: "https://github.com/tint0520/tint-town/blob/main/local_store.png?raw=true",
          scaledSize: new google.maps.Size(35, 35)
        }
      });

      marker.addListener('click', () => {
        showCardForStore(index);
      });

      markers.push(marker);
    });

    new markerClusterer.MarkerClusterer({ markers, map });
    stores.sort((a, b) => a.distance - b.distance);
    initSwiper();
  }});
}

// è¨ˆç®—è·é›¢
function calcDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  return (R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))).toFixed(2);
}

// åˆå§‹åŒ– Swiper å’Œå¡ç‰‡å…§å®¹
function initSwiper() {
  document.querySelector('.swiper-wrapper').innerHTML = stores.map((store, index) => `
    <div class="swiper-slide">
      <div style="position: relative;">
        <img src="${store.photo}" alt="${store.name}">
        <div class="favorite-btn" data-index="${index}">â­ï¸</div>
      </div>
      <div class="store-info">
        <h5>${store.name}</h5>
        <p>ç°¡ä»‹ï¼š${store.desc}</p>
        <p>æœå‹™ï¼š${store.type}</p>
        <p>æ¨™ç±¤ï¼š${store.tags}</p>
        <p>åœ°å€ï¼š${store.address}</p>
        <p>ç‡Ÿæ¥­æ™‚é–“ï¼š${store.hours}</p>
        <p>
          <a href="${store.link}">ğŸ”—æˆ‘è¦é ç´„</a> | 
          <a href="${store.ig}">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/instagram.svg" style="width:16px;height:16px; vertical-align:text-bottom;">
            Instagram
          </a> | 
          <a href="${store.line}">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/line.svg" style="width:16px;height:16px; vertical-align:text-bottom;">
            LINE
          </a>
        </p>
      </div>
      <div class="store-distance">
        è·é›¢ï¼š${store.distance} km | 
        <span class="map-btn" data-index="${index}">ğŸ—ºï¸åœ°åœ–ä½ç½®</span> | 
        <a href="https://www.google.com/maps/dir/?api=1&destination=${store.latlng}" target="_blank">ğŸš—å°èˆª</a>
      </div>
    </div>`).join('');

  swiper = new Swiper('.swiper-container', {
    slidesPerView: 'auto',
    spaceBetween: 15,
    centeredSlides: true
  });

  document.querySelectorAll('.map-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      showMapMarker(btn.getAttribute('data-index'));
    });
  });

  updateFavoriteIcons();
}

// åˆ‡æ›é é¢é¡¯ç¤º
function showView(viewId) {
  ['map-view','card-view','favorite-view'].forEach(id => {
    document.getElementById(id).style.display = (id === viewId) ? 'block' : 'none';
  });

  if (viewId === 'favorite-view') {
    renderFavorites();
  }
}

// é¡¯ç¤ºåœ°åœ–ä½ç½®
function showMapMarker(index) {
  const [lat, lng] = stores[index].latlng.split(",").map(Number);
  map.setCenter({lat, lng});
  map.setZoom(17);
  showView('map-view');
}

// é¡¯ç¤ºå¡ç‰‡
function showCardForStore(index) {
  showView('card-view');
  swiper.slideTo(index, 500, true);
}

// åˆå§‹åŒ–æ”¶è—åˆ—è¡¨
favorites = JSON.parse(localStorage.getItem('favorites')) || [];

// æª¢æŸ¥æ˜¯å¦å·²æ”¶è—
function isFavorited(storeName) {
  return favorites.includes(storeName);
}

// æ›´æ–°æ”¶è—æ˜Ÿæ˜Ÿåœ–ç¤º
function updateFavoriteIcons() {
  document.querySelectorAll('.favorite-btn').forEach(btn => {
    const index = btn.getAttribute('data-index');
    btn.textContent = isFavorited(stores[index].name) ? 'ğŸŒŸ' : 'â­ï¸';
  });
}

// é»æ“Šæ”¶è—æ˜Ÿæ˜Ÿåˆ‡æ›ç‹€æ…‹
document.addEventListener('click', e => {
  if (e.target.classList.contains('favorite-btn')) {
    const index = e.target.getAttribute('data-index');
    const storeName = stores[index].name;

    if (isFavorited(storeName)) {
      favorites = favorites.filter(name => name !== storeName);
    } else {
      favorites.push(storeName);
    }

    localStorage.setItem('favorites', JSON.stringify(favorites));
    updateFavoriteIcons();
  }
});

// æ¸²æŸ“æ”¶è—åˆ—è¡¨
function renderFavorites() {
  let html = '';
  const favoriteStores = stores.filter(store => favorites.includes(store.name));

  html = favoriteStores.length 
    ? favoriteStores.map(store => `
        <div class="card mb-3">
          <img src="${store.photo}" class="card-img-top">
          <div class="card-body">
            <h5>${store.name}</h5>
            <p>${store.desc}</p>
            <a href="${store.link}" target="_blank">ğŸ”— é ç´„åº—å®¶</a>
          </div>
        </div>`).join('')
    : '<p>ä½ é‚„æ²’æœ‰æ”¶è—ä»»ä½•åº—å®¶å–”ï¼</p>';

  document.getElementById('favorite-list').innerHTML = html;
}
</script>
</head>


  
<body>

<!-- æ­¡è¿ç•«é¢ -->
<div id="splash-screen">
  <img src="icon-192.png" alt="Tint Maps Logo" style="width:100px; height:100px; margin-bottom:20px;" />
  <div class="loader"></div>
  <p style="color:#d63384;margin-top:16px;">è¼‰å…¥è³‡æ–™ä¸­â€¦</p>
</div>
  
  <div class="top-banner">
  <div class="banner-text">Tint Maps</div>
  <div class="banner-subtext">æ‰¾é™„è¿‘çš„ç¾æ¥­åº—å®¶</div>
</div>

  <div id="map-view"></div>
  <div id="card-view" class="swiper-container">
    <div class="swiper-wrapper"></div>
  </div>

<div id="favorite-view" class="p-4">
  <h4>æˆ‘çš„æ”¶è—</h4>
  <div id="favorite-list"></div>
</div>

  <div id="bottom-nav">
    <div class="nav-btn" onclick="showView('map-view')">ğŸ—ºï¸<br>åœ°åœ–æ‰¾åº—</div>
    <div class="nav-btn" onclick="showView('card-view')">ğŸ“¸<br>å¡ç‰‡æ¢åº—</div>
    <div class="nav-btn" onclick="showView('favorite-view')">â¤ï¸<br>æˆ‘çš„æ”¶è—</div>
  </div>

<!-- Service Worker è¨»å†Š -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').then(reg => {
      console.log('ServiceWorker è¨»å†ŠæˆåŠŸï¼');
    }).catch(err => {
      console.log('ServiceWorker è¨»å†Šå¤±æ•—: ', err);
    });
  }

  // æ­¡è¿ç•«é¢æ·¡å‡ºæ§åˆ¶
  window.addEventListener('load', () => {
    setTimeout(() => {
      const splash = document.getElementById('splash-screen');
      if (splash) splash.style.display = 'none';
    }, 2000);
  });
</script>
<script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault(); // é˜²æ­¢ç€è¦½å™¨è‡ªå‹•é¡¯ç¤ºæç¤º
    deferredPrompt = e;

    // æª¢æŸ¥æ˜¯å¦å·²ç¶“åŠ éä¸»ç•«é¢
    if (!localStorage.getItem('alreadyInstalled')) {
      const customBtn = document.createElement('button');
      customBtn.textContent = 'ğŸ“² å°‡ Tint Maps åŠ åˆ°æ‰‹æ©Ÿä¸»ç•«é¢';
      customBtn.style.position = 'fixed';
      customBtn.style.bottom = '80px';
      customBtn.style.left = '50%';
      customBtn.style.transform = 'translateX(-50%)';
      customBtn.style.padding = '12px 20px';
      customBtn.style.borderRadius = '12px';
      customBtn.style.background = '#d63384';
      customBtn.style.color = 'white';
      customBtn.style.fontSize = '16px';
      customBtn.style.zIndex = '9999';
      customBtn.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
      customBtn.style.border = 'none';

      document.body.appendChild(customBtn);

      customBtn.addEventListener('click', () => {
        customBtn.style.display = 'none';
        deferredPrompt.prompt();

        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('ä½¿ç”¨è€…æ¥å—å®‰è£');
          } else {
            console.log('ä½¿ç”¨è€…æ‹’çµ•å®‰è£');
          }

          // è¨˜éŒ„ç‹€æ…‹ï¼Œä¸å†é¡¯ç¤ºæç¤º
          localStorage.setItem('alreadyInstalled', 'true');
          deferredPrompt = null;
        });
      });
    }
  });
</script>
 <!-- âœ… Safari å°ˆç”¨ä¸»ç•«é¢æç¤º -->
<div id="ios-install-prompt" style="display: none; position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
background: rgba(255, 255, 255, 0.95); padding: 16px 20px; border-radius: 12px;
box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-size: 15px; color: #333; text-align: center;
z-index: 9999; max-width: 80%;">
  <div style="margin-bottom: 10px;">
    ğŸ“² å°‡ <strong>Tint Maps</strong> åŠ åˆ°ä¸»ç•«é¢<br>
    â‘  é»æ“Š Safari ä¸‹æ–¹åˆ†äº«éˆ•<br>
    â‘¡ é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€
  </div>
  <button onclick="dismissIOSPrompt()" style="background-color: #d63384; color: white; border: none;
  border-radius: 8px; padding: 8px 16px; font-size: 14px; cursor: pointer;">æˆ‘çŸ¥é“äº†</button>
</div>

<!-- âœ… GPS æµ®çª— -->
<div id="gps-permission" style="display: none; position: fixed; top: 50%; left: 50%;
transform: translate(-50%, -50%); background: #fff; padding: 20px; border-radius: 10px;
z-index: 9999; box-shadow: 0 0 10px rgba(0,0,0,0.2); text-align:center;">
  <p>ğŸ“ ç‚ºäº†å¹«ä½ æ‰¾é™„è¿‘çš„åº—å®¶ï¼Œè«‹å…è¨±å®šä½</p>
  <button onclick="requestLocation()">å…è¨±å®šä½</button>
  <button onclick="dismissLocationPopup()">ç¨å¾Œå†èªª</button>
</div>

<!-- âœ… é¦–æ¬¡å°è¦½æµ®çª— -->
<div id="onboarding" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
z-index: 9998; background: rgba(255,255,255,0.95); display: flex; align-items: center;
justify-content: center; flex-direction: column;">
  <div class="onboarding-step" id="step-1">
    <h2 style="color:#d63384;">ğŸ“¦ æ»‘å‹•å¡ç‰‡</h2>
    <p>å·¦å³æ»‘å‹•ç€è¦½æ‰€æœ‰åº—å®¶</p>
    <button onclick="nextStep(2)">ä¸‹ä¸€æ­¥</button>
  </div>
  <div class="onboarding-step" id="step-2" style="display:none;">
    <h2 style="color:#d63384;">â­ æ”¶è—åŠŸèƒ½</h2>
    <p>é»æ˜Ÿæ˜Ÿå¯æ”¶è—å–œæ„›çš„åº—å®¶</p>
    <button onclick="nextStep(3)">ä¸‹ä¸€æ­¥</button>
  </div>
  <div class="onboarding-step" id="step-3" style="display:none;">
    <h2 style="color:#d63384;">ğŸ“ åœ°åœ–æ‰¾åº—</h2>
    <p>é»é¸åœ°åœ–åœ–æ¨™å¯æŸ¥çœ‹åº—å®¶</p>
    <button onclick="endOnboarding()">æˆ‘çŸ¥é“äº†</button>
  </div>
</div>

<!-- âœ… æˆé•·æ•¸æ“šå‹•ç•«æµ®çª— -->
<div id="growth-toast" style="display:none; position:fixed; top:20px; left:50%; transform:translateX(-50%);
background:#fff3f7; color:#d63384; font-weight:bold; font-size:15px; padding:12px 20px;
border-radius:20px; box-shadow:0 3px 10px rgba(0,0,0,0.15); z-index:9999;">
âœ¨ ä»Šå¤©æ–°å¢ <span id="today-count">0</span> å®¶ï¼Œå·²æœ‰ <span id="total-count">0</span> äººä½¿ç”¨ Tint Mapsï¼
</div>

<!-- âœ… æ§åˆ¶é‚è¼¯ -->
<script>
function isIosSafari() {
  const ua = window.navigator.userAgent;
  return /iPhone|iPad|iPod/i.test(ua) && /Safari/i.test(ua) && !/CriOS|FxiOS|OPiOS/i.test(ua);
}
function dismissIOSPrompt() {
  localStorage.setItem('iosInstallDismissed', 'true');
  document.getElementById('ios-install-prompt').style.display = 'none';
}

function animateNumber(targetEl, from, to, duration) {
  const start = performance.now();
  const step = (timestamp) => {
    const progress = Math.min((timestamp - start) / duration, 1);
    const value = Math.floor(progress * (to - from) + from);
    targetEl.textContent = value;
    if (progress < 1) requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

function nextStep(step) {
  document.querySelectorAll('.onboarding-step').forEach(el => el.style.display = 'none');
  document.getElementById(`step-${step}`).style.display = 'block';
}
function endOnboarding() {
  document.getElementById('onboarding').style.display = 'none';
  localStorage.setItem('onboarded', 'true');
}

function requestLocation() {
  document.getElementById('gps-permission').style.display = 'none';
  navigator.geolocation.getCurrentPosition(pos => {
    console.log('âœ… å®šä½æˆåŠŸ', pos);
    localStorage.setItem('gpsAllowed', 'true');
    location.reload();
  }, () => {
    alert('ç„¡æ³•å–å¾—ä½ç½®');
  });
}
function dismissLocationPopup() {
  document.getElementById('gps-permission').style.display = 'none';
  localStorage.setItem('gpsAllowed', 'false');
}

window.addEventListener('load', () => {
  if (isIosSafari() && !window.navigator.standalone && !localStorage.getItem('iosInstallDismissed')) {
    setTimeout(() => {
      document.getElementById('ios-install-prompt').style.display = 'block';
    }, 3000);
  }

  const toast = document.getElementById('growth-toast');
  const now = Date.now();
  const startTime = now - (7 * 24 * 60 * 60 * 1000);
  const secondsSince = Math.floor((now - startTime) / 1000);
  const growthPerSecond = 1 / 60;
  const totalGrowth = Math.floor(secondsSince * growthPerSecond);
  const total = 1000 + totalGrowth;
  const today = Math.floor(86400 * growthPerSecond);

  animateNumber(document.getElementById('today-count'), 0, today, 1500);
  animateNumber(document.getElementById('total-count'), total - 50, total, 2000);
  toast.style.display = 'block';
  setTimeout(() => toast.style.display = 'none', 5000);

  if (!localStorage.getItem('gpsAllowed')) {
    document.getElementById('gps-permission').style.display = 'block';
  }
  if (!localStorage.getItem('onboarded')) {
    document.getElementById('onboarding').style.display = 'flex';
  }
});
</script>
</body>
</html>
